

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>任务发布 &mdash; MgDataStorm 1.0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="任务模板" href="task_template.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MgDataStorm
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">安装文档</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user_guide.html">使用文档</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="task_template.html">任务模板</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">任务发布</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MgDataStorm</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="user_guide.html">使用文档</a> &raquo;</li>
        
      <li>任务发布</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/task_publish.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>任务发布<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>这部分主要介绍代码发布的配置和一些SQL相关配置(更新中)，任务发布后续将会支持更多业务模块，目前以任务发布和SQL优化审核相关的配置为主；</div></blockquote>
<p><strong>操作教学视频</strong>：<a class="reference external" href="https://www.bilibili.com/video/av53424572/">https://www.bilibili.com/video/av53424572/</a></p>
<p><strong>应用发布</strong></p>
<blockquote>
<div>该模块是任务发布主要功能，预先配置你代码发布的相关信息，设定时间自动执行。</div></blockquote>
<p>例举例一个简单发布示例：</p>
<blockquote>
<div>请选择你要发布的应用，具体配置参考【作业配置】-【应用配置】。发布权限关联代码仓库权限【作业配置】-【代码仓库】。</div></blockquote>
<p><strong>创建应用发布</strong></p>
<p>点开<code class="docutils literal notranslate"><span class="pre">应用发布</span></code></p>
<ul class="simple">
<li>选择应用：下拉选择在作业配置中配置的应用配置</li>
<li>标签版本：输入你的TAG</li>
<li>自定义参数：前面定义参数，后面填写对应值(例如：[IP] [203.167.11.100] )</li>
<li>开始时间：选择一个执行时间，来触发模板中的定时触发器</li>
<li>备注详情：填写你发布应用的标识</li>
</ul>
<p><img alt="./_static/images/app_publish_1.png" src="./_static/images/app_publish_1.png" /></p>
<p><strong>SQL审核</strong></p>
<blockquote>
<div>该模块用来将要执行的SQl语句的提交给审批人进行审批，审批通过后才会在指定时间执行该SQL语句</div></blockquote>
<p><strong>注意</strong></p>
<ul class="simple">
<li>1.当前页面使用标签关联相关数据库，选取标签下的mysql的写库</li>
<li>2.本服务多部署在内网，为了适配多云多区域，需要经过代理连接数据库，标签里面应配置代理主机，当前任务会跳转到代理主机执行数据库审核</li>
<li>3.请使用标准的SQL语句，从语句上选择数据库。</li>
<li>4.使用内建模板ID：9001主机组为1在没有熟悉模板的使用之前，不要随意更改相关任务模板</li>
</ul>
<p>点开<code class="docutils literal notranslate"><span class="pre">SQL审核</span></code></p>
<ul class="simple">
<li>目标标签：下拉选择你要关联的标签组</li>
<li>SQL语句：填写要执行的SQL语句</li>
<li>审批人员：下拉选择你要提交审核的用户</li>
</ul>
<p><img alt="./_static/images/sql_auth.png" src="./_static/images/sql_auth.png" /></p>
<p><strong>SQL优化</strong></p>
<blockquote>
<div>该模块用于优化SQL语句，输入要执行的SQL语句然后进行平分和优化等操作</div></blockquote>
<p><strong>注意</strong></p>
<ul class="simple">
<li>1.当前页面使用标签关联相关数据库，选取标签下的mysql,SQL优化使用内建模板ID：9901主机组为1，在没有熟悉模板的使用之前，不要随意更改相关任务模板</li>
<li>2.本服务多部署在内网，为了适配多云多区域，需要经过代理连接数据库，标签信息里面应配置代理主机，当前任务会跳转到代理主机执行</li>
</ul>
<p>点开<code class="docutils literal notranslate"><span class="pre">SQL优化</span></code></p>
<ul class="simple">
<li>目标标签：下拉选择你要关联的标签组(注意:目标库只能选择一个数据库)</li>
<li>数据库名：输入要操作的数据库名称</li>
<li>优化类型：选择优化类型<code class="docutils literal notranslate"><span class="pre">SOAR</span></code>或<code class="docutils literal notranslate"><span class="pre">SQLAdvisor</span></code></li>
<li>SQL语句：填写要优化的SQL语句</li>
<li>操作： 选择你要操作的选项<code class="docutils literal notranslate"><span class="pre">SQL评分</span></code>,<code class="docutils literal notranslate"><span class="pre">SQL指纹</span></code>,<code class="docutils literal notranslate"><span class="pre">SQL美化</span></code>,<code class="docutils literal notranslate"><span class="pre">语法检查</span></code></li>
</ul>
<p><img alt="./_static/images/sql_opti.png" src="./_static/images/sql_opti.png" /></p>
<p><strong>资源申购</strong></p>
<blockquote>
<div>该模块用于申购服务器，数据库，Redis，负载均衡等资源使用(更新中)</div></blockquote>
<p><strong>节点添加</strong></p>
<blockquote>
<div>用于横向扩展Kubernetes(K8S)节点(更新中)</div></blockquote>
<p><strong>自定义任务</strong></p>
<blockquote>
<div>该模块可以更灵活的添加自己要对服务器操作的任务模板</div></blockquote>
<p><strong>注意</strong></p>
<ul class="simple">
<li>1.当前页面使用标签关联相关主机，选取标签下的主机, 系统直连主机并发执行选择模板的任务，为了减轻任务压力，限制并发100以内</li>
</ul>
<p>点开<code class="docutils literal notranslate"><span class="pre">自定义任务</span></code></p>
<ul class="simple">
<li>目标标签：下拉选择自定义的标签组</li>
<li>选择模板：下拉选择自定义的模板</li>
<li>参数1：填写上传的参数和对应参数值(可增加和删除参数选项)</li>
<li>执行时间：选择一个执行时间，用来触发模板中的定时触发器</li>
</ul>
<p><img alt="./_static/images/custom_task.png" src="./_static/images/custom_task.png" /></p>
<p><strong>自定义任务-代理</strong></p>
<blockquote>
<div>该模块用于处理无法直连服务器需要通过代理连接来执行一些任务</div></blockquote>
<p><strong>注意</strong></p>
<ul class="simple">
<li>1.当前页面使用标签关联相关主机，选取标签下的主机,在代理主机上执行选择模板的任务，并把主机名，IP地址传给任务，任务本身通过ansible、saltsatck、多线程、多进程等方法来进行并发。参数IP：SERVER_IP,主机名：SERVER_HOST一般可以作为salt name。</li>
</ul>
<p>点开<code class="docutils literal notranslate"><span class="pre">自定义任务-代理</span></code></p>
<ul class="simple">
<li>目标标签：下拉选择自定义的标签组(注意：标签可以多选，但是代理主机有且仅有一个，不可多选)</li>
<li>选择模板：下拉选择自定义的模板</li>
<li>参数：填写上传的参数和对应参数值(可增加和删除参数选项)</li>
<li>执行时间：选择一个执行时间，用来触发模板中的定时触发</li>
</ul>
<p><img alt="./_static/images/custom_task_proxy.png" src="./_static/images/custom_task_proxy.png" /></p>
<p><strong>自定义任务-JSON</strong></p>
<blockquote>
<div>该模块提供了自定义JSON的方式更方便灵活的来进行自定义任务</div></blockquote>
<p><strong>注意：参数详解</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
	<span class="nt">&quot;task_name&quot;</span><span class="p">:</span> <span class="s2">&quot;任务名称&quot;</span><span class="p">,</span>
	<span class="nt">&quot;submitter&quot;</span><span class="p">:</span> <span class="s2">&quot;提交人&quot;</span><span class="p">,</span>
	<span class="nt">&quot;temp_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
	<span class="nt">&quot;schedule&quot;</span><span class="p">:</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span>
	<span class="nt">&quot;exec_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-11-27 14:09:50&quot;</span><span class="p">,</span>
	<span class="nt">&quot;associated_user&quot;</span><span class="p">:</span> <span class="s2">&quot;{&#39;group-1&#39;: [&#39;杨红飞&#39;]}&quot;</span><span class="p">,</span>
	<span class="nt">&quot;args&quot;</span><span class="p">:</span> <span class="s2">&quot;{&#39;VERSION&#39;:&#39;eeee&#39;, &#39;arg02&#39;: &#39;xxxx&#39;}&quot;</span><span class="p">,</span>
	<span class="nt">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;这里是备注&quot;</span><span class="p">,</span>
	<span class="nt">&quot;hosts&quot;</span><span class="p">:</span> <span class="s2">&quot;{1: &#39;127.0.0.1&#39;}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>1.task_name: 任务名字</li>
<li>2.submitter: 提交人</li>
<li>3.temp_id：模板ID，就是你上面创建模板时候生成的那个ID</li>
<li>4.schedule：这是状态，常用的有ready和new ready：表示不通过人工审核，只要到了执行时间直接执行任务new：表示需要任何审核，管理员审核，选择执行时间，到时间后开始执行</li>
<li>5.exec_time： 任务执行时间，状态为ready的情况下，到这个时间会进行执行</li>
<li>6.args：这里是一个字典，里面的参数可以自行定义，如上，你模板参数里面用到了哪些你都可以在这里定义出来，当你的POST到这个接口时候，我们会自动接受此参数，并帮你运行脚本 解析你要传入的参数。</li>
<li>7.details：描述，备注信息</li>
<li>8.hosts：这个是执行主机，字典形式， 1表示第一组主机，也就是上面模板里面的组1，任务支持多组。主机IP，这个是执行主机，这个废话多一点，比如我以上模板的脚本在172.16.0.101这台主机上，我就想平台登陆我这个主机，来帮我执行这些脚本，至于怎么登陆，那么就是我最开始在平台里面配置了一个执行用户，我将我这个主机的私钥放到了平台上，公钥在我服务器上，这样子CODO平台就可以ssh -i xxxx.pem&#64;{ip_address}远程到我的主机上帮我执行命令。</li>
</ul>
<p>点开<code class="docutils literal notranslate"><span class="pre">自定义任务-JSON</span></code></p>
<ul class="simple">
<li>POST JSON：输入你的数据，参考上面的示例，你也可以二次开发对接自己的CMDB获取主机，时间字段从下面获取，方便处理(注意：提交的数据必须以JSON格式，请严格按照说明提交)</li>
<li>执行时间：选择一个执行时间，用来触发模板中的定时触发</li>
</ul>
<p><img alt="./_static/images/custom_task_json.png" src="./_static/images/custom_task_json.png" /></p>
<p>PS：已经文档会在后续过程中不断更新完善，感谢大家支持。</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="task_template.html" class="btn btn-neutral float-left" title="任务模板" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, HcSystem MgDataStorm Docs

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>